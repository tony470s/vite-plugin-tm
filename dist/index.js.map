{"version":3,"sources":["../src/index.ts","../src/common/constant.ts","../src/lib/client-code.ts","../src/common/utils.ts","../src/lib/grants.ts","../src/lib/tm-header.ts","../src/lib/build-options.ts","../src/lib/plugin.ts"],"sourcesContent":["import type { TmHeaderConfig } from \"common/constant\";\n\nexport { tampermonkeyPlugin as default } from \"lib/plugin\";\nexport function defineTmHeader(options: TmHeaderConfig): TmHeaderConfig {\n  return options;\n}\n","import type { Merge, Writeable } from 'common/type'\r\n\r\nexport const DEV_MODE = 'development'\r\nexport const PROD_MODE = 'production'\r\nexport const GM_ADD_STYLE = 'GM_addStyle'\r\nexport const DEFAULT_NPM_CDN = 'https://unpkg.com'\r\nexport const INTRO_FOR_PLACEHOLDER = 'console.warn(\"__TEMPLATE_INJECT_CSS_PLACEHOLDER_NOT_WORK__\")'\r\n\r\nexport const grants = [\r\n  'unsafeWindow',\r\n  'GM_addStyle',\r\n  'GM_addElement',\r\n  'GM_deleteValue',\r\n  'GM_listValues',\r\n  'GM_addValueChangeListener',\r\n  'GM_removeValueChangeListener',\r\n  'GM_setValue',\r\n  'GM_getValue',\r\n  'GM_log',\r\n  'GM_getResourceText',\r\n  'GM_getResourceURL',\r\n  'GM_registerMenuCommand',\r\n  'GM_unregisterMenuCommand',\r\n  'GM_openInTab',\r\n  'GM_xmlhttpRequest',\r\n  'GM_download',\r\n  'GM_getTab',\r\n  'GM_saveTab',\r\n  'GM_getTabs',\r\n  'GM_notification',\r\n  'GM_setClipboard',\r\n  'GM_info'\r\n] as const\r\n\r\nexport type Grant = typeof grants[number]\r\nexport type Grants = Writeable<typeof grants>\r\n\r\nexport const tmHeaderKeys = [\r\n  'name',\r\n  'name:en',\r\n  'name:zh',\r\n  'name:zh-cn',\r\n  'version',\r\n  'description',\r\n  'description:en',\r\n  'description:zh',\r\n  'description:zh-cn',\r\n  'author',\r\n  'namespace',\r\n  'license',\r\n  'include',\r\n  'require',\r\n  'homepage',\r\n  'homepageURL',\r\n  'website',\r\n  'source',\r\n  'icon',\r\n  'iconURL',\r\n  'defaulticon',\r\n  'icon64',\r\n  'icon64URL',\r\n  'updateURL',\r\n  'downloadURL',\r\n  'supportURL',\r\n  'match',\r\n  'exclude',\r\n  'resource',\r\n  'connect',\r\n  'run-at',\r\n  'grant',\r\n  'noframes',\r\n  'unwrap',\r\n  'nocompat',\r\n  'antifeature'\r\n] as const\r\n\r\ntype RunAt = 'document-start' | 'document-body' | 'document-end' | 'document-idle' | 'context-menu'\r\ntype AntiFeature = 'ads' | 'tracking' | 'miner'\r\n\r\ntype TmHeaderKey = typeof tmHeaderKeys[number]\r\nexport type BareTmHeaderConfig = Partial<Record<TmHeaderKey, string | string[]>>\r\nexport type TmHeaderConfig = Merge<BareTmHeaderConfig, {\r\n  noframes?: boolean;\r\n  nocompat?: boolean;\r\n  unwrap?: boolean;\r\n  grant?: Grant | Grant[];\r\n  'run-at'?: RunAt | RunAt[];\r\n  antifeature?: AntiFeature | AntiFeature[];\r\n}>\r\nexport type TmHeaderConfigKeys = Array<keyof TmHeaderConfig>\r\n","import type { AddressInfo } from \"node:net\";\nimport { grants } from \"common/constant\";\n\nexport function generateClientCode(\n  scheme: string,\n  { address, port }: AddressInfo,\n  entry?: string\n) {\n  return `\n  const url = '${scheme}://${address}:${port}'\n\n  const originFetch = unsafeWindow.fetch\n  const ping = '/__vite_ping'\n  unsafeWindow.fetch = function(input, init) {\n    if (input === ping) {\n      input = url + ping\n    }\n    return originFetch(input, init)\n  }\n\n  ${grants.map((item) => `unsafeWindow.${item} = ${item}`).join(\"\\n  \")}\n\n  function createModuleScript(path) {\n    if (typeof GM_addElement == 'function') {\n      return GM_addElement('script', {\n        type: 'module',\n        src: url + '/' + path\n      })\n    } else {\n      const script = document.createElement('script')\n      script.type = 'module'\n      script.src = url + '/' + path\n      document.body.appendChild(script)\n      return script\n    }\n  }\n\n  createModuleScript('@vite/client')\n  createModuleScript('${entry ?? \"src/main.ts\"}')\n`;\n}\n","import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { DEFAULT_NPM_CDN } from \"./constant\";\nimport type { TMExternalGlobals } from \"lib/plugin\";\n\nconst root = process.cwd();\n\nexport function readJSON(filePath: string) {\n  const json = fs.readFileSync(filePath, \"utf8\");\n  return JSON.parse(json);\n}\n\nexport function readPackageJSON() {\n  const packagePath = path.resolve(root, \"package.json\");\n  return readJSON(packagePath);\n}\n\nexport function buildName(name: string) {\n  return name.replace(/(^|-)([A-Za-z])/g, (m) =>\n    m.replace(\"-\", \"\").toUpperCase()\n  );\n}\n\nexport function buildGlobalName(input: TMExternalGlobals) {\n  if (!input) return input;\n  if (Array.isArray(input)) {\n    const result: Record<string, string> = {};\n    for (const name of input) {\n      result[name] = buildName(name);\n    }\n    return result;\n  }\n  const globals: Record<string, string> = {};\n  for (const [key, value] of Object.entries(input)) {\n    if (Array.isArray(value)) {\n      globals[key] = value[0];\n    } else {\n      globals[key] = value;\n    }\n  }\n  return globals;\n}\n\nfunction buildDefaultCDN(packageName: string) {\n  const packagePath = path.resolve(\n    root,\n    `node_modules/${packageName}/package.json`\n  );\n  if (fs.existsSync(packagePath)) {\n    const { version = \"latest\" } = readJSON(packagePath);\n    return `${DEFAULT_NPM_CDN}/${packageName}@${version}`;\n  }\n  return `${DEFAULT_NPM_CDN}/${packageName}`;\n}\n\nexport function buildRequireCDN(input: TMExternalGlobals) {\n  if (!input) return [];\n  if (Array.isArray(input)) {\n    return input.map((name) => buildDefaultCDN(name)).filter(Boolean);\n  }\n  const requireCDNs: string[] = [];\n  for (const [key, value] of Object.entries(input)) {\n    if (Array.isArray(value)) {\n      value[1] && requireCDNs.push(value[1]);\n      continue;\n    }\n    requireCDNs.push(buildDefaultCDN(key));\n  }\n  return requireCDNs;\n}\n\nexport function defaultEntry() {\n  const tsconfigFile = path.resolve(root, \"vite.config.js\");\n  const extension = fs.existsSync(tsconfigFile) ? \"ts\" : \"js\";\n  return path.resolve(root, `src/main.${extension}`);\n}\n\nexport function getDefinedConfig() {\n  const jsonPath = path.resolve(root, \"header.config.json\");\n  if (fs.existsSync(jsonPath)) {\n    return readJSON(jsonPath);\n  }\n  const jsPath = path.resolve(root, \"header.config.js\");\n  if (fs.existsSync(jsPath)) {\n    // eslint-disable-next-line unicorn/prefer-module\n    return require(jsPath);\n  }\n  const txtPath = path.resolve(root, \"header.config.txt\");\n  if (fs.existsSync(txtPath)) {\n    return fs.readFileSync(txtPath, \"utf8\");\n  }\n  return readPackageJSON().tmHeader;\n}\n\nexport function readBundleFile(\n  directory: string | undefined,\n  fileName: string\n) {\n  const distribution = directory || path.resolve(root, \"dist\");\n  const filePath = path.resolve(distribution, fileName);\n  return fs.readFileSync(filePath, \"utf8\");\n}\n\nexport function writeBundleFile(\n  directory: string | undefined,\n  fileName: string,\n  data: string\n) {\n  const distribution = directory || path.resolve(root, \"dist\");\n  const filePath = path.resolve(distribution, fileName);\n  fs.writeFileSync(filePath, data);\n}\n","import { full as walkFull } from 'acorn-walk'\r\nimport { GM_ADD_STYLE, grants } from 'common/constant'\r\nimport type { Grant, Grants, TmHeaderConfig } from 'common/constant'\r\nimport type { Plugin } from 'vite'\r\n\r\nconst grantsSet = new Set<Grant>(grants)\r\nconst usedGrants = new Set<Grant>()\r\n\r\nexport function parseGrant(autoGrant: boolean | undefined): Partial<Plugin> {\r\n  if (autoGrant === false) return {}\r\n  return {\r\n    name: 'tm-userscript-grant',\r\n    moduleParsed(moduleInfo) {\r\n      if (/\\.(ts|js|vue)$/.test(moduleInfo.id) && moduleInfo.ast) {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        walkFull(moduleInfo.ast, (node: any) => {\r\n          if (node.type === 'CallExpression') {\r\n            const calleeName = node.callee.name\r\n            if (calleeName && grantsSet.has(calleeName)) {\r\n              usedGrants.add(calleeName)\r\n            }\r\n          }\r\n          if (node.type === 'Identifier' && grantsSet.has(node.name)) {\r\n            usedGrants.add(node.name)\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function addUsedGrants(tmConfig: TmHeaderConfig, isDevelopment = false) {\r\n  if (isDevelopment) {\r\n    tmConfig.grant = grants as Grants\r\n    return\r\n  }\r\n  if (!Array.isArray(tmConfig.grant)) {\r\n    tmConfig.grant = [tmConfig.grant].filter(Boolean) as Grants\r\n  }\r\n  tmConfig.grant = [...new Set([...tmConfig.grant, ...usedGrants])]\r\n}\r\n\r\nexport function addExtraTmGrant(tmConfig: TmHeaderConfig) {\r\n  if (!Array.isArray(tmConfig.grant)) {\r\n    tmConfig.grant = [tmConfig.grant].filter(Boolean) as Grants\r\n  }\r\n  if (!tmConfig.grant.includes(GM_ADD_STYLE)) {\r\n    tmConfig.grant.push(GM_ADD_STYLE)\r\n  }\r\n  return tmConfig\r\n}\r\n","import { DEV_MODE, tmHeaderKeys } from 'common/constant'\r\nimport { buildRequireCDN, getDefinedConfig, readPackageJSON } from 'common/utils'\r\nimport { addExtraTmGrant, addUsedGrants } from './grants'\r\nimport type { Nested } from 'common/type'\r\nimport type { TmHeaderConfig, TmHeaderConfigKeys } from 'common/constant'\r\nimport type { TMExternalGlobals } from './plugin'\r\n\r\ntype DealMetaFunction = (v: Nested<string>) => string | Nested<string>[]\r\n\r\nexport function generateTmHeader(mode: string, input: TMExternalGlobals, hasCss: boolean) {\r\n  const definedConfig = getDefinedConfig() ?? {}\r\n  if (typeof definedConfig == 'string') return definedConfig\r\n  const packageJson = readPackageJSON()\r\n  const config: TmHeaderConfig = {}\r\n  for (const key of tmHeaderKeys) {\r\n    const value = definedConfig[key] ?? packageJson[key]\r\n    if (value) config[key] = value\r\n  }\r\n  config.require = [\r\n    ...(Array.isArray(config.require) ? config.require : [config.require ?? '']),\r\n    ...buildRequireCDN(input)\r\n  ].filter(Boolean)\r\n  if (mode === DEV_MODE) {\r\n    addUsedGrants(config, true)\r\n    config.name = '[ Dev ] - ' + config.name\r\n  } else {\r\n    hasCss && addExtraTmGrant(config)\r\n    addUsedGrants(config)\r\n  }\r\n  const definedMetaKeys = Object.keys(config) as TmHeaderConfigKeys\r\n  const maxKeyLength = Math.max(...definedMetaKeys.map(k => k.length))\r\n  const definedMetaBlock = definedMetaKeys.flatMap(key => {\r\n    const value = config[key] as Nested<string>\r\n    const spaces = Array.from({ length: maxKeyLength - key.length + 8 }).join(' ')\r\n    const dealMeta: DealMetaFunction = v => {\r\n      if (Array.isArray(v)) return v.map(element => dealMeta(element))\r\n      if (typeof v == 'boolean' && v === true) return `// @${key}`\r\n      return `// @${key}${spaces}${v}`\r\n    }\r\n    return dealMeta(value)\r\n  })\r\n  return [\r\n    '// ==UserScript==',\r\n    ...definedMetaBlock,\r\n    '// ==/UserScript==',\r\n  ].join('\\n')\r\n}\r\n","import { INTRO_FOR_PLACEHOLDER } from 'common/constant'\r\nimport { buildGlobalName, buildName, defaultEntry, readPackageJSON } from 'common/utils'\r\nimport type { BuildOptions } from 'vite'\r\nimport type { TMPluginOptions, TMExternalGlobals } from './plugin'\r\n\r\ntype GetRollupOption = (input: TMExternalGlobals) => BuildOptions['rollupOptions']\r\ntype GetLibraryOption = (entry: TMPluginOptions['entry']) => BuildOptions['lib']\r\n\r\nexport const getRollupOptions: GetRollupOption = input => {\r\n  const external = Array.isArray(input) ? input : Object.keys(input ?? {})\r\n  const globals = buildGlobalName(input)\r\n  return {\r\n    external,\r\n    output: {\r\n      globals,\r\n      intro: INTRO_FOR_PLACEHOLDER,\r\n      inlineDynamicImports: true\r\n    }\r\n  }\r\n}\r\n\r\nexport const getLibraryOptions: GetLibraryOption = entry => {\r\n  const { name: packageName } = readPackageJSON()\r\n  if (!packageName) {\r\n    const error = 'props `name` in package.json is required!'\r\n    console.error(error)\r\n    throw new Error(error)\r\n  }\r\n  const name = buildName(packageName)\r\n  return {\r\n    name,\r\n    entry: entry ?? defaultEntry(),\r\n    formats: ['iife'],\r\n    fileName: () => `${packageName}.user.js`\r\n  }\r\n}\r\n","import { generateClientCode } from \"./client-code\";\nimport { generateTmHeader } from \"./tm-header\";\nimport { parseGrant } from \"./grants\";\nimport { getLibraryOptions, getRollupOptions } from \"./build-options\";\nimport {\n  DEV_MODE,\n  GM_ADD_STYLE,\n  INTRO_FOR_PLACEHOLDER,\n  PROD_MODE,\n} from \"common/constant\";\nimport type { Plugin } from \"vite\";\nimport type { AddressInfo } from \"node:net\";\n\nexport interface TMPluginOptions {\n  entry?: string;\n  autoGrant?: boolean;\n  externalGlobals?: string[] | Record<string, string | string[]>;\n}\nexport type TMExternalGlobals = TMPluginOptions[\"externalGlobals\"];\n\ntype Address = AddressInfo | null | undefined;\n\nfunction generateDevelopmentCode(\n  scheme: string,\n  address: Address,\n  input: TMExternalGlobals,\n  entry?: string\n) {\n  if (!address) return \"\\u5904\\u7406\\u5927\\u5931\\u8D25\\u4E86\\u55F7...\";\n  const tmHeader = generateTmHeader(DEV_MODE, input, true);\n  const code = generateClientCode(scheme, address, entry);\n  return `${tmHeader}\\n\\n(function () {\\n${code}\\n})()`;\n}\n\nfunction getAddress(address: Address | string) {\n  return typeof address == \"object\" ? address : undefined;\n}\n\nconst DEV_TAMPERMONKEY_PATH = \"/_development.user.js\";\nconst showInstallLog = (isHttps: Boolean, address: AddressInfo) => {\n  const url = `${isHttps ? \"https\" : \"http\"}://${address.address}:${\n    address.port\n  }${DEV_TAMPERMONKEY_PATH}`;\n  setTimeout(() => {\n    console.log(\n      \"\\u001B[36m%s\\u001B[0m\",\n      `> [TMPlugin] - click link to install userscript: ${url}`\n    );\n  });\n};\n\nexport function tampermonkeyPlugin(options: TMPluginOptions = {}): Plugin[] {\n  const { entry, externalGlobals, autoGrant } = options;\n  const { moduleParsed } = parseGrant(autoGrant);\n\n  return [\n    {\n      name: \"tm-userscript-builder\",\n      moduleParsed,\n      configureServer(server) {\n        return () => {\n          const isHttps = !!server.config.server.https;\n          server.httpServer?.on(\"listening\", () => {\n            const address = getAddress(server.httpServer?.address());\n            address && showInstallLog(isHttps, address);\n          });\n          server.middlewares.use((request, response, next) => {\n            let scheme_result = isHttps ? \"https\" : \"http\";\n            if (request.url === DEV_TAMPERMONKEY_PATH) {\n              const address = getAddress(server.httpServer?.address());\n              const developmentCode = generateDevelopmentCode(\n                scheme_result,\n                address,\n                externalGlobals,\n                entry\n              );\n              response.setHeader(\"Cache-Control\", \"no-store\");\n              response.write(developmentCode);\n            }\n            next();\n          });\n        };\n      },\n      config(config) {\n        // let hmr = config.server?.hmr;\n        // if (typeof hmr === \"boolean\" || !hmr) hmr = {};\n        // hmr.protocol = \"ws\";\n        // hmr.host = \"127.0.0.1\";\n        // config.server = {\n        //   ...config.server,\n        //   hmr,\n        // };\n        config.build = {\n          lib: getLibraryOptions(entry),\n          rollupOptions: getRollupOptions(externalGlobals),\n          minify: false,\n          sourcemap: false,\n          cssCodeSplit: false,\n        };\n      },\n    },\n    {\n      name: \"tm-userscript-inject\",\n      apply: \"build\",\n      enforce: \"post\",\n      generateBundle(_options, bundle) {\n        const bundleKeys = Object.keys(bundle);\n        const cssBundles = bundleKeys.filter((key) => key.endsWith(\".css\"));\n        const jsBundles = bundleKeys.filter((key) => key.endsWith(\".js\"));\n        const cssList = [];\n        for (const css of cssBundles) {\n          const chunk = bundle[css];\n          if (chunk.type === \"asset\" && typeof chunk.source == \"string\") {\n            delete bundle[css];\n            cssList.push(chunk.source);\n            continue;\n          }\n        }\n        const hadCss = cssList.length > 0;\n        const tmHeader = generateTmHeader(PROD_MODE, externalGlobals, hadCss);\n        for (const js of jsBundles) {\n          const chunk = bundle[js];\n          if (chunk.type === \"chunk\") {\n            let chunkCode = chunk.code;\n            for (const [moduleKey, moduleValue] of Object.entries(\n              chunk.modules\n            )) {\n              if (/\\.(c|le|sc)ss$/.test(moduleKey) && moduleValue.code) {\n                const cssCode = moduleValue.code\n                  .replaceAll(\"'\", '\"')\n                  .replaceAll(\"#__PURE__\", \"@__PURE__\");\n                chunkCode = chunkCode.replace(cssCode, \"\");\n              }\n            }\n            chunk.code =\n              tmHeader +\n              \"\\n\\n\" +\n              chunkCode.replace(\n                INTRO_FOR_PLACEHOLDER,\n                hadCss ? `${GM_ADD_STYLE}(\\`\\n${cssList.join(\"\\n\")}  \\`)` : \"\"\n              );\n          }\n        }\n      },\n    },\n  ];\n}\n"],"mappings":"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","names":["fs","path","walkFull","_a"]}